<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8">
    <title>Atlas Indígena do Paraná</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
    <link href="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.js"></script>
    
    <style>
        body { margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        
        #container { display: flex; height: 100vh; width: 100vw; }
        
        #sidebar {
            width: 30%;
            min-width: 300px; /* Garante que o menu não fique muito fino */
            background: #fdfaf6;
            padding: 25px;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            overflow-y: auto;
            z-index: 1;
        }

        #map { flex-grow: 1; position: relative; } /* position relative ajuda a segurar o mapa */

        h1 { color: #8b4513; margin-top: 0; }
        h2 { color: #d2691e; border-bottom: 1px solid #ddd; padding-bottom: 10px; }
        .info-box { background: white; padding: 15px; border-radius: 8px; border: 1px solid #eee; margin-top: 20px; }
        .instruction { color: #777; font-style: italic; margin-top: 20px; }

        .legend {
            position: absolute;
            bottom: 30px;
            right: 30px;
            background: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            font-size: 12px;
            z-index: 2; /* Garante que fique acima do mapa */
        }
        .legend-item { display: flex; align-items: center; margin-bottom: 5px; }
        .color-box { width: 15px; height: 15px; margin-right: 8px; border-radius: 3px; }
    </style>
</head>
<body>

<div id="container">
    <div id="sidebar">
        <h1>Atlas Indígena PR</h1>
        <p>Um mapeamento digital das comunidades e territórios tradicionais no estado do Paraná.</p>
        
        <div id="info-dinamica">
            <p class="instruction">Passe o mouse ou clique sobre uma Terra Indígena no mapa para ver os detalhes históricos e demográficos aqui.</p>
        </div>
    </div>

    <div id="map"></div>
    
    <div class="legend">
        <div class="legend-item"><div class="color-box" style="background: rgba(210, 105, 30, 0.4); border: 2px solid #8b4513;"></div>Terra Indígena</div>
    </div>
</div>

<script>
    mapboxgl.accessToken = 'pk.eyJ1Ijoid2VuZGVsa2YxIiwiYSI6ImNtaXRjb2FlMTE0MHozZ3B5aWl1NHlkcDcifQ.1gzV_UTP3dVw9mSuZCzVNA';

    const map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/outdoors-v12',
        center: [-52.0, -24.0], // Ajustei o centro para focar mais no Paraná
        zoom: 6
        // Deixei sem limites (maxBounds) por enquanto para garantir que o mapa apareça
    });

    map.addControl(new mapboxgl.NavigationControl());

    map.on('load', () => {

        // --- CARREGAR O ARQUIVO EXTERNO ---
        // ATENÇÃO: Renomeie seu arquivo na pasta para "dados.geojson" (sem acento, tudo minúsculo)
        fetch('dados.geojson') 
            .then(response => {
                if (!response.ok) { 
                    throw new Error("Arquivo não encontrado! Verifique se o nome é 'dados.geojson'"); 
                }
                return response.json();
            })
            .then(data => { 
                
                // 1. Adiciona os dados
                map.addSource('terras-indigenas', {
                    'type': 'geojson',
                    'data': data
                });

                // 2. Camada Visual (Preenchimento)
                map.addLayer({
                    'id': 'ti-fill',
                    'type': 'fill',
                    'source': 'terras-indigenas',
                    'paint': {
                        'fill-color': '#d2691e',
                        'fill-opacity': 0.4
                    }
                });

                // 3. Camada Visual (Borda)
                map.addLayer({
                    'id': 'ti-outline',
                    'type': 'line',
                    'source': 'terras-indigenas',
                    'paint': {
                        'line-color': '#8b4513',
                        'line-width': 2
                    }
                });

                // --- INTERATIVIDADE ---
                
                // Evento de Clique
                map.on('click', 'ti-fill', (e) => {
                    const props = e.features[0].properties;
                    console.log("Dados da área clicada:", props); // Veja no F12 os nomes corretos

                    // Tenta adivinhar os nomes das colunas. 
                    // Se o seu arquivo tiver nomes diferentes, altere aqui.
                    const nome = props.nome || props.NM_TI || props.nome_ti || 'Nome não disponível';
                    const etnia = props.etnia || props.DS_ETNIA || props.etnia_pr || 'Vários';
                    const area = props.area_ha || props.AREA_HA || '---';

                    const sidebarContent = document.getElementById('info-dinamica'); 

// --- INÍCIO DO BLOCO DA FOTO ---
let htmlDaFoto = ''; // Começa vazio para não atrapalhar as outras aldeias

// ATENÇÃO: Troque 'TI Rio das Cobras' pelo nome exato da aldeia que você quer
// ATENÇÃO: Troque 'props.NOME_DA_SUA_COLUNA' pelo nome da coluna que tem o nome da terra (ex: props.NM_TI ou apenas nome)
if (props.terrai_nom === 'Marrecas') {
    htmlDaFoto = `
        <div style="margin: 15px 0;">
            <img src="Marrecas_campo.jfif" style="width: 100%; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.2);">
            <p style="font-size: 11px; color: #555; font-style: italic; margin-top: 5px;">
                Registro da visita de campo.
            </p>
        </div>
    `;
}
// --- FIM DO BLOCO DA FOTO ---


                    sidebarContent.innerHTML = `
        <h2>${props.terrai_nom}</h2>
        ${htmlDaFoto}
        <div class="info-box">
            <p><strong>Município:</strong> ${props.municipio_}</p>
            <p><strong>Modalidade da TI:</strong> ${props.modalidade}</p>
            <p><strong>Etnia:</strong> ${props.etnia_nome}</p>
            <p><strong>Situação:</strong> <span class="tag">${props.fase_ti}</span></p>
            
            <hr> <p>Isso é um atlas interativo!</p>
        </div>
    `;
                });

                // Mudar cursor ao passar o mouse
                map.on('mouseenter', 'ti-fill', () => map.getCanvas().style.cursor = 'pointer');
                map.on('mouseleave', 'ti-fill', () => map.getCanvas().style.cursor = '');
                
            })
            .catch(error => {
                console.error('Erro:', error);
                alert('Erro! Abra o console (F12) para ver o detalhe. Dica: Use o Live Server.');
            });

    }); // Fim do map.on('load')
</script>

</body>
</html>