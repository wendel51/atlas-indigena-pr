<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8">
    <title>Atlas Indígena do Paraná</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
    
    <link href="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
    
    <style>
        body { margin: 0; padding: 0; font-family: 'Open Sans', sans-serif; }
        
        #container { display: flex; height: 100vh; width: 100vw; }
        
        #sidebar {
            width: 30%;
            min-width: 300px;
            background: #fdfaf6;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            z-index: 1;
            
            /* MUDANÇA 1: O sidebar agora é um container flexível */
            display: flex;
            flex-direction: column; /* Organiza itens um embaixo do outro */
            padding: 0; /* O padding vai para os filhos agora */
            overflow: hidden; /* Importante: impede que a barra toda role */
        }

        /* --- CABEÇALHO FIXO --- */
        .sidebar-header {
            /* Fixo visualmente */
            flex-shrink: 0; /* Impede que o cabeçalho seja esmagado */
            background: #fdfaf6; /* Mesma cor do fundo para tampar o texto subindo */
            padding: 25px 25px 10px 25px; /* Espaçamento interno */
            
            display: flex;
            align-items: center;
            border-bottom: 1px solid #e0dcd5;
            z-index: 10;
        }

        /* --- ÁREA QUE ROLA (SCROLL) --- */
        .sidebar-content {
            flex-grow: 1; /* Ocupa todo o espaço que sobrar */
            overflow-y: auto; /* AQUI ESTÁ A MÁGICA: Só essa parte rola! */
            padding: 10px 25px 25px 25px;
        }

        /* --- O BOTÃO BOLINHA --- */
        .btn-voltar-sidebar {
            display: block;
            width: 60px;  /* Altura e largura iguais */
            height: 60px; 
            border-radius: 50%; /* BOLINHA PERFEITA */
            overflow: hidden;
            border: 3px solid white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: transform 0.2s;
            flex-shrink: 0;
            background: #ddd;
        }

        .btn-voltar-sidebar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .btn-voltar-sidebar:hover {
            transform: scale(1.1);
            border-color: #d2691e;
        }

        .texto-voltar {
            margin-left: 15px;
            display: flex;
            flex-direction: column;
            line-height: 1.2;
        }

        .texto-voltar span {
            font-size: 0.85em;
            color: #666;
        }

        .texto-voltar strong {
            font-family: 'Cinzel', serif;
            font-size: 1.2em;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #d2691e;
        }

        /* --- RESTO --- */
        #sidebar h1 {
            margin-top: 10px;
            color: #8b4513;
            font-family: 'Cinzel', serif;
            font-size: 1.8em;
        }

        #map { flex-grow: 1; position: relative; }
        h2 { color: #d2691e; border-bottom: 1px solid #ddd; padding-bottom: 10px; margin-top: 0;}
        .info-box { background: white; padding: 15px; border-radius: 8px; border: 1px solid #eee; margin-top: 20px; }
        
        .legend {
            position: absolute; bottom: 30px; right: 30px; background: white;
            padding: 10px; border-radius: 5px; box-shadow: 0 0 10px rgba(0,0,0,0.1);
            font-size: 12px; z-index: 2; font-family: 'Open Sans', sans-serif;
        }
        .legend-item { display: flex; align-items: center; margin-bottom: 5px; }
        .color-box { width: 15px; height: 15px; margin-right: 8px; border-radius: 3px; }
        .tag { background: #eee; padding: 2px 6px; border-radius: 4px; font-size: 0.9em; font-weight: bold; color: #555; }
    </style>
</head>
<body>

<div id="container">
    <div id="sidebar">
        
        <div class="sidebar-header">
            <a href="index.html" class="btn-voltar-sidebar">
                <img src="atlas_pr_cortada.jpg" alt="Voltar">
            </a>
            <div class="texto-voltar">
                <span>Voltar ao</span>
                <strong>Portal</strong>
            </div>
        </div>

        <div class="sidebar-content">
            <h1>Atlas Indígena do Paraná</h1>
            <p>Um mapeamento digital das comunidades e territórios indígenas no estado do Paraná.</p>
            
            <div id="info-dinamica">
                <p class="instruction" style="color: #777; font-style: italic; margin-top: 20px;">
                    Passe o mouse ou clique sobre uma Terra Indígena no mapa para ver os detalhes históricos e demográficos aqui.
                </p>
            </div>
        </div>
        
    </div>

    <div id="map"></div>
    
    <div class="legend">
        <div class="legend-item"><div class="color-box" style="background: rgba(210, 105, 30, 0.4); border: 2px solid #8b4513;"></div>Terra Indígena</div>
    </div>
</div>

<script>
    mapboxgl.accessToken = 'pk.eyJ1Ijoid2VuZGVsa2YxIiwiYSI6ImNtajBpc21yZzBhM2IzZnEzanNiejA4NnQifQ.kgBfR1jL1k2qtmj7-GQfiw';

    const map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/wendelkf1/cmj1m45lr002601qn61g2e170',
        center: [-52.0, -24.5],
        zoom: 6.5
    });

    map.addControl(new mapboxgl.NavigationControl());

    map.on('load', () => {
        fetch('dados.geojson') 
            .then(response => {
                if (!response.ok) throw new Error("Erro ao carregar GeoJSON"); 
                return response.json();
            })
            .then(data => { 
                map.addSource('terras-indigenas', { 'type': 'geojson', 'data': data });

                map.addLayer({
                    'id': 'ti-fill',
                    'type': 'fill',
                    'source': 'terras-indigenas',
                    'paint': { 'fill-color': '#d2691e', 'fill-opacity': 0.4 }
                });

                map.addLayer({
                    'id': 'ti-outline',
                    'type': 'line',
                    'source': 'terras-indigenas',
                    'paint': { 'line-color': '#8b4513', 'line-width': 2 }
                });

                map.on('click', 'ti-fill', (e) => {
                    const props = e.features[0].properties;
                    
                    let htmlDaFoto = ''; 
                    if (props.terrai_nom === 'Marrecas') {
                        htmlDaFoto = `
                            <div style="margin: 15px 0;">
                                <img src="Marrecas_campo.jfif" style="width: 100%; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.2);">
                                <p style="font-size: 11px; color: #555; font-style: italic; margin-top: 5px;">Registro da visita de campo.</p>
                            </div>
                        `;
                    }

                    const sidebarContent = document.getElementById('info-dinamica'); 

                    sidebarContent.innerHTML = `
                        <h2>${props.terrai_nom}</h2>
                        ${htmlDaFoto}
                        <div class="info-box">
                            <p><strong>Município:</strong> ${props.municipio_}</p>
                            <p><strong>Modalidade:</strong> ${props.modalidade}</p>
                            <p><strong>Etnia:</strong> ${props.etnia_nome}</p>
                            <p><strong>Situação:</strong> <span class="tag">${props.fase_ti}</span></p>
                            <hr style="border: 0; border-top: 1px solid #eee; margin: 15px 0;"> 
                            <p style="font-size: 0.9em; color: #666;">Dados oficiais FUNAI/IBGE.</p>
                        </div>
                    `;
                });

                map.on('mouseenter', 'ti-fill', () => map.getCanvas().style.cursor = 'pointer');
                map.on('mouseleave', 'ti-fill', () => map.getCanvas().style.cursor = '');
            })
            .catch(error => console.error('Erro:', error));
    }); 
</script>

</body>
</html>
